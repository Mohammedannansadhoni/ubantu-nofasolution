<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Online Registration Editor - {{event.eventName}}</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }

    .toolbar {
      display: flex;
      padding: 10px;
      background: #ffffff;
      border-bottom: 1px solid #ccc;
      gap: 10px;
      flex-wrap: wrap;
    }

    .toolbar select,
    .toolbar input[type="file"],
    .toolbar button {
      padding: 8px 12px;
      border: 1px solid #ccc;
      background-color: #fff;
      border-radius: 4px;
      cursor: pointer;
    }

    .page-wrapper {
      display: flex;
      flex-direction: column;
      margin: 20px;
      border: 2px solid #aaa;
      transition: all 0.3s ease;
    }

    /* Full-page mode - expands canvas to fill entire viewport */
    .page-wrapper.full-page-mode {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      margin: 0;
      border: none;
      z-index: 1000;
      background: transparent;
    }

    .page-wrapper.full-page-mode .toolbar {
      position: absolute;
      top: 10px;
      left: 10px;
      right: 10px;
      z-index: 1001;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    header, footer {
      background-color: #ffffff;
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid #ccc;
      position: relative;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    footer {
      border-top: 1px solid #ccc;
      border-bottom: none;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    }

    /* Enhanced header styling */
    header .header-content {
      max-width: 1200px;
      margin: 0 auto;
    }

    header h1 {
      transition: all 0.3s ease;
    }

    header h1:hover {
      color: #667eea;
      transform: scale(1.02);
    }

    header p {
      transition: all 0.3s ease;
    }

    header p:hover {
      color: #333;
    }

    /* Enhanced footer styling */
    footer .footer-content {
      max-width: 1200px;
      margin: 0 auto;
    }

    footer p {
      transition: all 0.3s ease;
    }

    footer p:hover {
      color: #667eea;
    }

    /* Editable content styling */
    [contenteditable="true"] {
      outline: none;
      transition: all 0.3s ease;
      border-radius: 4px;
      padding: 2px 4px;
    }

    [contenteditable="true"]:hover {
      background: rgba(102, 126, 234, 0.1);
    }

    [contenteditable="true"]:focus {
      background: rgba(102, 126, 234, 0.15);
      box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
    }

    .canvas-container {
      flex: 1;
      padding: 20px;
      min-height: 400px;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-color: #ffffff;
      transition: all 0.3s ease;
    }

    /* Full-page canvas styling */
    .page-wrapper.full-page-mode .canvas-container {
      width: 100vw;
      height: 100vh;
      padding: 0;
      margin: 0;
      min-height: 100vh;
      background-attachment: fixed;
    }

    .page-wrapper.full-page-mode .canvas-content {
      padding: 80px 20px 20px 20px; /* Top padding for toolbar */
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Hide headers/footers in full-page mode */
    .page-wrapper.full-page-mode header,
    .page-wrapper.full-page-mode footer {
      display: none;
    }

    .canvas-content {
      padding: 20px;
      color: #000;
    }

    .resizable-logo-wrapper {
      display: inline-block;
      position: relative;
      resize: both;
      overflow: hidden;
      min-width: 50px;
      min-height: 50px;
      max-width: 90%;
      max-height: 300px;
      border: 2px dashed #ccc;
      margin: auto;
    }

    .resizable-logo-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    .resizable-logo-wrapper::after {
      content: "Click to upload";
      position: absolute;
      bottom: 4px;
      right: 6px;
      font-size: 10px;
      color: #888;
    }

    .logo-upload {
      display: none;
    }

    .canvas-container *:focus {
      outline: 2px dashed blue;
    }

    /* Registration form styles */
    .registration-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .registration-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
      padding: 48px 36px 36px 36px;
      max-width: 440px;
      width: 100%;
      border: 1.5px solid #e0e0e0;
    }

    .event-logo {
      max-width: 110px;
      margin: 0 auto 18px auto;
      display: block;
    }

    .event-title {
      font-size: 1.45rem;
      font-weight: 700;
      margin-bottom: 18px;
      text-align: center;
      color: #222;
    }

    .event-header {
      font-size: 1.1rem;
      font-weight: 500;
      text-align: center;
      margin-bottom: 18px;
      color: #333;
    }

    .registration-form label {
      font-weight: 500;
      margin-bottom: 4px;
      color: #222;
      display: block;
    }

    .registration-form input,
    .registration-form select {
      width: 100%;
      padding: 13px 14px;
      border: 1.5px solid #cfd8dc;
      border-radius: 7px;
      margin-bottom: 20px;
      font-size: 1.07rem;
      background: #f7fafd;
      transition: border 0.2s;
    }

    .registration-form input:focus,
    .registration-form select:focus {
      border: 1.5px solid #0a1931;
      outline: none;
    }

    .registration-form input[type="submit"] {
      background: #0a1931;
      color: #fff;
      border: none;
      border-radius: 7px;
      font-size: 1.13rem;
      font-weight: 700;
      padding: 14px 0;
      margin-top: 10px;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 8px rgba(10, 25, 49, 0.08);
      transition: background 0.2s;
      cursor: pointer;
    }

    .registration-form input[type="submit"]:hover {
      background: #1a2951;
    }

    .registration-form .required {
      color: #d32f2f;
      margin-left: 2px;
    }

    .registration-form .form-note {
      font-size: 0.97em;
      color: #888;
      margin-bottom: 12px;
      text-align: left;
    }

    .event-footer {
      font-size: 1rem;
      text-align: center;
      margin-top: 22px;
      color: #666;
    }

    @media (max-width: 600px) {
      .registration-card {
        padding: 24px 8px 18px 8px;
        max-width: 98vw;
      }
    }

    /* Reorder mode styles - Creative Design */
    .form-field {
      position: relative;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Toggle Button Styling */
    #toggleReorder {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 25px;
      padding: 10px 20px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    /* Full Page Toggle Button Styling */
    #toggleFullPage {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      color: white;
      border: none;
      border-radius: 25px;
      padding: 10px 20px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    #toggleFullPage:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
    }

    #toggleFullPage.active {
      background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }

    #toggleFullPage::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    #toggleFullPage:hover::before {
      left: 100%;
    }

    /* Preview Button Styling */
    #previewRegistration {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
      border: none;
      border-radius: 25px;
      padding: 10px 20px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    #previewRegistration:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
    }

    #previewRegistration::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    #previewRegistration:hover::before {
      left: 100%;
    }

    #toggleReorder:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    #toggleReorder.active {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
    }

    #toggleReorder::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    #toggleReorder:hover::before {
      left: 100%;
    }

    /* Reorder Mode Active */
    .reorder-mode .form-field {
      background: linear-gradient(145deg, #ffffff 0%, #f8f9ff 100%);
      border: 2px solid #e3f2fd;
      border-radius: 16px;
      margin: 15px 0;
      padding: 20px;
      cursor: grab;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
      transform: translateZ(0);
      position: relative;
    }

    .reorder-mode .form-field:hover {
      border-color: #2196f3;
      box-shadow: 0 12px 35px rgba(33, 150, 243, 0.15);
      transform: translateY(-2px);
    }

    .reorder-mode .form-field.dragging {
      opacity: 0.9;
      transform: rotate(3deg) scale(1.02);
      z-index: 1000;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      cursor: grabbing;
    }

    .reorder-mode .form-field.drag-over {
      border-color: #4caf50;
      background: linear-gradient(145deg, #e8f5e8 0%, #f1f8e9 100%);
      box-shadow: 0 12px 35px rgba(76, 175, 80, 0.2);
    }

    /* Creative Drag Handle */
    .reorder-mode .form-field::before {
      content: "";
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      width: 6px;
      height: 30px;
      background: linear-gradient(to bottom, #2196f3 0%, #64b5f6 50%, #2196f3 100%);
      border-radius: 3px;
      opacity: 0.7;
      box-shadow: 
        3px 0 0 rgba(33, 150, 243, 0.3),
        6px 0 0 rgba(33, 150, 243, 0.2);
    }

    /* Field Number Badge */
    .field-order-indicator {
      position: absolute;
      top: -10px;
      right: -10px;
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      color: white;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      border: 3px solid white;
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
      z-index: 10;
      animation: bounceIn 0.6s ease;
    }

    @keyframes bounceIn {
      0% { transform: scale(0); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    .reorder-mode .field-order-indicator {
      display: flex;
    }

    /* Instructions Banner */
    .reorder-instructions {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 18px 20px;
      margin: 20px 0;
      text-align: center;
      font-weight: 600;
      font-size: 14px;
      display: none;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
      position: relative;
      overflow: hidden;
    }

    .reorder-instructions::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .reorder-mode .reorder-instructions {
      display: block;
      animation: slideDown 0.5s ease;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Disabled form inputs in reorder mode */
    .reorder-mode .registration-form input,
    .reorder-mode .registration-form select {
      pointer-events: none;
      background: linear-gradient(145deg, #f5f5f5 0%, #eeeeee 100%);
      opacity: 0.7;
    }

    /* Helper text for drag action */
    .reorder-mode .form-field::after {
      content: "Drag me ↕";
      position: absolute;
      right: 20px;
      top: 15px;
      font-size: 11px;
      color: #2196f3;
      background: rgba(33, 150, 243, 0.1);
      padding: 4px 8px;
      border-radius: 12px;
      border: 1px solid rgba(33, 150, 243, 0.2);
      font-weight: 500;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    /* Success animation when dropping */
    .drop-success {
      animation: dropSuccess 0.6s ease;
    }

    @keyframes dropSuccess {
      0% { background: #4caf50; }
      100% { background: initial; }
    }
  </style>
</head>
<body>

  <!-- Toolbar -->
  <div class="toolbar">
    <select id="dropdown">
      <option value="">Select Option</option>
      <option value="header">Add Header</option>
      <option value="footer">Add Footer</option>
    </select>

    <input type="file" accept="image/*" id="uploadImg" title="Upload Background Image">

    <select id="alignment">
      <option value="">Align</option>
      <option value="left">Left</option>
      <option value="center">Center</option>
      <option value="right">Right</option>
    </select>

    <button id="toggleFullPage">🖼️ Full Page</button>
    <button id="setRequired">Required</button>
    <button id="previewRegistration">📋 Preview</button>
    <button id="toggleReorder">Reorder Fields</button>
    <button id="generatePublicUrl">🌐 Generate Public URL</button>
    <button id="saveNext">Save & Next</button>
  </div>

  <!-- Page Container -->
  <div class="page-wrapper" id="pageWrapper">

    <div class="canvas-container" id="canvas">
      <div class="canvas-content" contenteditable="false">
        <div class="registration-container">
          <div class="registration-card">
            <img src="https://via.placeholder.com/110x60?text=Logo" class="event-logo" alt="Event Logo" contenteditable="false">
            <div class="event-title" contenteditable="true">{{#if event.eventName}}{{event.eventName}}{{else}}Sample Event Name{{/if}}</div>
            <div class="event-header" contenteditable="true">Welcome to Our Event Registration</div>

            <form class="registration-form" action="/event/{{eventId}}/public-register" method="POST">
              <div class="reorder-instructions">
                ✨ Reorder Mode Active! Drag any field up or down to rearrange the form layout. Click "Exit Reorder Mode" when done.
              </div>
              
              {{#each fields}}
                <div class="form-field" data-field-name="{{this.fieldName}}" data-field-order="{{@index}}">
                  <div class="field-order-indicator">{{add @index 1}}</div>
                  {{formField this.fieldName this.fieldLabel this.fieldType this.fieldValue this.fieldMandatory ../badgeCategories this.dropdownOptions}}
                </div>
              {{/each}}

              <div class="form-note" contenteditable="true">Please provide the correct email address you would like to receive your confirmation email.</div>
              <input type="submit" value="REGISTER">
            </form>

            <div class="event-footer" contenteditable="true">Thank you for registering!</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<style>
.stepwizard {
    margin-bottom: 30px;
}

.stepwizard-row {
    display: table-row;
}

.stepwizard-step {
    display: table-cell;
    width: 25%;
    height: 200px;
    text-align: center;
    position: relative;
}

.stepwizard-step button[disabled] {
    opacity: 1 !important;
    filter: alpha(opacity=100) !important;
}

.stepwizard-step .btn-circle {
    width: 50px;
    height: 50px;
    text-align: center;
    padding: 6px 0;
    font-size: 18px;
    line-height: 1.428571429;
    border-radius: 25px;
    margin-bottom: 10px;
}

.stepwizard-step p {
    margin-top: 10px;
    color: #666;
    font-weight: 500;
}

.step-content {
    display: none;
    padding: 30px;
}

.step-content.active {
    display: block;
}

.btn-circle.btn-primary {
    background-color: #007bff;
    border-color: #007bff;
}

.btn-circle.btn-success {
    background-color: #28a745;
    border-color: #28a745;
}

.mt-3 {
    margin-top: 1rem;
}

.mb-4 {
    margin-bottom: 1.5rem;
}

.registration-preview, .confirmation-preview, .email-config-preview {
    border: 2px solid #e9ecef;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.link-generation {
    max-width: 600px;
    margin: 0 auto;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Step navigation
    document.querySelectorAll('.next-step').forEach(function(btn) {
        btn.addEventListener('click', function() {
            var nextStep = this.getAttribute('data-next');
            showStep(nextStep);
        });
    });

    document.querySelectorAll('.prev-step').forEach(function(btn) {
        btn.addEventListener('click', function() {
            var prevStep = this.getAttribute('data-prev');
            showStep(prevStep);
        });
    });

    document.querySelectorAll('.step-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            var step = this.getAttribute('data-step');
            showStep(step);
        });
    });

    function showStep(stepNumber) {
        // Hide all step contents
        document.querySelectorAll('.step-content').forEach(function(content) {
            content.classList.remove('active');
        });

        // Show selected step
        document.getElementById('step-' + stepNumber).classList.add('active');

        // Update step buttons
        document.querySelectorAll('.step-btn').forEach(function(btn) {
            btn.classList.remove('btn-primary', 'btn-success');
            btn.classList.add('btn-default');
        });

        // Highlight current and completed steps
        for(var i = 1; i <= stepNumber; i++) {
            var btn = document.querySelector('[data-step="' + i + '"]');
            if(i < stepNumber) {
                btn.classList.remove('btn-default');
                btn.classList.add('btn-success');
            } else if(i == stepNumber) {
                btn.classList.remove('btn-default');
                btn.classList.add('btn-primary');
            }
        }
    }

    // Generate link functionality
    document.getElementById('generate-link').addEventListener('click', function() {
        var btn = this;
        btn.disabled = true;
        btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Generating...';

        fetch('/event/online-registration/{{eventId}}/generate-link', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if(data.success) {
                document.getElementById('public-url').value = data.publicUrl;
                document.getElementById('copy-link').style.display = 'inline-block';
                document.getElementById('test-link').style.display = 'inline-block';
                
                // Show success message
                var alert = document.createElement('div');
                alert.className = 'alert alert-success';
                alert.innerHTML = '<strong>Success!</strong> Your public registration link has been generated.';
                document.querySelector('.link-generation').insertBefore(alert, document.querySelector('.alert-info'));

                btn.innerHTML = '<i class="fa fa-check"></i> Link Generated';
                btn.classList.remove('btn-success');
                btn.classList.add('btn-success');
            } else {
                alert('Error generating link: ' + data.error);
                btn.disabled = false;
                btn.innerHTML = '<i class="fa fa-link"></i> Generate Public Link';
            }
        })
        .catch(error => {
            alert('Network error occurred');
            btn.disabled = false;
            btn.innerHTML = '<i class="fa fa-link"></i> Generate Public Link';
        });
    });

    // Copy link functionality
    document.getElementById('copy-link').addEventListener('click', function() {
        var urlInput = document.getElementById('public-url');
        urlInput.select();
        document.execCommand('copy');
        
        this.innerHTML = '<i class="fa fa-check"></i> Copied!';
        setTimeout(() => {
            this.innerHTML = '<i class="fa fa-copy"></i> Copy';
        }, 2000);
    });

    // Test link functionality
    document.getElementById('test-link').addEventListener('click', function() {
        var url = document.getElementById('public-url').value;
        if(url) {
            window.open(url, '_blank');
        }
    });
});
</script>
